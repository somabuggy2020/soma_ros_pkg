<?xml version="1.0"?>
<launch>
	<!-- arguments -->
	<arg name="pcd_file" value="/home/hayashi/Mirais-Map-2021-02.pcd" />
	<arg name="pcd_pub_interval" value="5.0" />
	<arg name="pcd_frame_id" value="map" />
	<arg name="nodelet_manager" default="cloud_manager" />
	<!-- load configuration file (yaml) -->
	<!-- <rosparam command="load" file="$(find soma_smpls)/config/3dmap_analyze.yaml" /> -->
	<!-- PCD publish -->
	<node name="pcd_publisher" pkg="pcl_ros" type="pcd_to_pointcloud" args="$(arg pcd_file) $(arg pcd_pub_interval)">
		<param name="frame_id" value="$(arg pcd_frame_id)" />
	</node>
	<!-- prefiltering -->
	<node name="$(arg  nodelet_manager)" pkg="nodelet" type="nodelet" args="manager" />
	<node name="height_clip" pkg="nodelet" type="nodelet" args="load pcl/PassThrough cloud_manager">
		<remap from="~input" to="/cloud_pcd" />
		<param name="filter_field_name" value="z" />
		<param name="filter_limit_min" value="0.4" />
		<param name="filter_limit_max" value="2.5" />
	</node>
	<!--
	<node name="x_range_clip" pkg="nodelet" type="nodelet" args="load pcl/PassThrough cloud_manager">
	<remap from="~input" to="/height_clip/output" />
	<param name="filter_field_name" value="x" />
	<param name="filter_limit_min" value="0.4" />
	<param name="filter_limit_max" value="100.0" />
	</node>
	-->
	<node pkg="nodelet" type="nodelet" name="prefiltering_nodelet" args="load hdl_graph_slam/PrefilteringNodelet $(arg nodelet_manager)">
		<remap from="/velodyne_points" to="/height_clip/output" />
		<param name="base_link_frame" value="$(arg pcd_frame_id)" />
		<!-- distance filter -->
		<param name="use_distance_filter" value="true" />
		<param name="distance_near_thresh" value="0.001" />
		<param name="distance_far_thresh" value="25.0" />
		<!-- NONE, VOXELGRID, or APPROX_VOXELGRID -->
		<param name="downsample_method" value="VOXELGRID" />
		<param name="downsample_resolution" value="0.05" />
		<!-- NONE, RADIUS, or STATISTICAL -->
		<param name="outlier_removal_method" value="STATISTICAL" />
		<param name="statistical_mean_k" value="30" />
		<param name="statistical_stddev" value="1.0" />
		<param name="radius_radius" value="0.5" />
		<param name="radius_min_neighbors" value="2" />
	</node>
	<!--  -->
	<node name="segmentation" pkg="nodelet" type="nodelet" args="load jsk_pcl/RegionGrowingSegmentation $(arg nodelet_manager)">
		<remap from="~input" to="/filtered_points" />
	</node>
	<node name="decomposer" pkg="nodelet" type="nodelet" args="load jsk_pcl/ClusterPointIndicesDecomposer $(arg nodelet_manager)">
		<remap from="~input" to="/filtered_points" />
		<remap from="~target" to="segmentation/output" />
		<!-- <param name="publish_clouds" value="true"/> -->
	</node>
	<!--  -->
	<!--  -->
	<!--  -->
	<node name="visualizer" pkg="rviz" type="rviz" args="-d $(find soma_smpls)/rviz/3dmap_analyze.rviz" />
</launch>
